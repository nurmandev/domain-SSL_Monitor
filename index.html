<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Indian Tambola Game - Classic</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", Verdana, sans-serif;
        background: linear-gradient(135deg, #dde3f0 0%, #fef6e3 100%);
      }
      body {
        min-height: 100vh;
      }
      .container {
        max-width: 470px;
        margin: 18px auto 18px auto;
        background: #fffdfa;
        border-radius: 19px;
        box-shadow: 0 8px 38px #4f4b5022;
        padding: 9px 3vw 19px 3vw;
      }
      .title-banner {
        text-align: center;
        padding: 17px 8px 12px 8px;
        margin: 0 auto 13px auto;
        border-radius: 17px 17px 16px 16px;
        background: linear-gradient(90deg, #e6f3ff 0%, #cce2fc 80%);
        border: 2.8px solid #7bb2ff;
        box-shadow: 0 2px 14px #b8dbff6a, 0 1.5px 8px #91baff30;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .title-banner .ticon {
        font-size: 1.8em;
        color: #3586e7;
        margin-bottom: 5px;
      }
      .title {
        font-size: 2.05rem;
        font-weight: bold;
        color: #1e3774;
        text-shadow: 0 2px 7px #e6f2ffb0;
      }
      .organizer-panel {
        background: linear-gradient(90deg, #f8fbff 0%, #f0f8fe 80%);
        border: 1.7px solid #94baf2;
        border-radius: 0 0 15px 15px;
        box-shadow: 0 1px 10px #cfe7ff3a inset;
        text-align: center;
        padding: 9px 7px 7px 7px;
        color: #224772;
        font-size: 1.1rem;
        margin-bottom: 10px;
      }
      .prizes {
        display: flex;
        flex-wrap: wrap;
        gap: 9px;
        justify-content: center;
        margin-bottom: 13px;
      }
      .prize {
        background: #ffeabf;
        border: 2px solid #1974c1;
        padding: 7px 12px;
        border-radius: 12px;
        font-weight: bold;
        color: #205490;
        font-size: 1.02rem;
        box-shadow: 0 2px 6px #cbe4ff5e;
      }
      .prize.claimed {
        background: #c5f4c0;
        border-color: #187f0b;
        color: #1f5e23;
        text-decoration: line-through;
      }
      .set-claim-bar {
        text-align: center;
        margin-bottom: 12px;
        margin-top: 7px;
      }
      .set-claim-btn {
        padding: 9px 24px;
        font-size: 1.11rem;
        font-weight: 600;
        background: linear-gradient(90deg, #ffd08a 0%, #57d37a 100%);
        color: #135634;
        border: none;
        border-radius: 12px;
        box-shadow: 0 2px 9px #aeeece;
        cursor: pointer;
        transition: background 0.22s;
        margin: 0 2px;
      }
      .set-claim-btn:disabled {
        background: #e4e4e4;
        color: #aaa;
        cursor: not-allowed;
      }
      .call-section {
        margin: 16px 0 10px 0;
        text-align: center;
      }
      .announce-block {
        display: inline-block;
        border: 4px solid #268af8;
        background: #f7fcff;
        border-radius: 23px;
        box-shadow: 0 2px 13px #3d8bff2c;
        padding: 14px 32px 8px 32px;
        margin-bottom: 8px;
        min-width: 130px;
      }
      .called-phrase {
        font-size: 1.21rem;
        color: #2b7fc6;
        font-weight: 700;
        margin-bottom: 0.18em;
        margin-top: 0.1em;
      }
      .called-number {
        font-size: 2.11rem;
        color: #f7a100;
        margin: 0;
        font-weight: bold;
        letter-spacing: 4px;
      }
      .recent-panel {
        text-align: center;
        margin: 11px auto 7px auto;
        font-size: 1.07rem;
        color: #377ec4;
        letter-spacing: 1px;
      }
      .recent-announcements {
        max-width: 380px;
        margin: 0 auto 12px auto;
        background: #f2f7ff;
        border-radius: 13px;
        box-shadow: 0 2px 7px #79c2ff26;
        font-size: 1.11rem;
        padding: 7px 8px 5px 10px;
        min-height: 38px;
        max-height: 55px;
        overflow-y: auto;
        border: 1.3px solid #62b6fc;
        display: flex;
        gap: 9px;
        flex-wrap: wrap;
        justify-content: flex-start;
        align-items: center;
      }
      .recent-item {
        background: #e1f2ff;
        border-radius: 7px;
        padding: 1px 9px;
        margin: 1px 0;
        font-weight: bold;
        color: #166ba5;
        font-size: 1.06rem;
        box-shadow: 0 1px 4px #6fcbf048;
      }
      .winner-banner,
      .boo-banner {
        background: #e0ffe0;
        color: #1a8824;
        font-size: 1.11rem;
        border-radius: 13px;
        border: 2px solid #44c22d;
        text-align: center;
        margin: 14px auto 17px auto;
        padding: 9px 6px 7px 6px;
        box-shadow: 0 2px 13px #60ff493c;
        animation: winnerflash 1.1s linear infinite alternate;
        max-width: 340px;
        font-weight: bold;
        z-index: 12;
        position: relative;
      }
      .boo-banner {
        background: #ffe5e2;
        color: #b00d0d;
        border-color: #f76d4e;
        animation: booflash 0.7s linear infinite alternate;
      }
      @keyframes winnerflash {
        0% {
          box-shadow: 0 0 8px #e2ff9d;
        }
        100% {
          box-shadow: 0 0 22px #41e748;
        }
      }
      @keyframes booflash {
        0% {
          box-shadow: 0 0 7px #ffbeb1;
        }
        100% {
          box-shadow: 0 0 19px #ff7a63;
        }
      }
      .set-prize-banner {
        background: #e6caff;
        color: #184978;
        font-weight: bold;
        font-size: 1.1rem;
        border-radius: 10px;
        margin: 15px 0 0 0;
        padding: 6px 0;
        box-shadow: 0 2px 14px #bc7cff30;
        border: 2px solid #3c62ba;
        text-align: center;
        animation: flash 1.1s alternate infinite;
      }
      @keyframes flash {
        0% {
          box-shadow: 0 0 10px #8dc2f6;
        }
        100% {
          box-shadow: 0 0 19px #4b85d8;
        }
      }
      .tickets-col {
        display: flex;
        flex-direction: column;
        gap: 15px;
        align-items: center;
        margin-bottom: 0.2rem;
        margin-top: 7px;
      }
      .tambola-ticket-glass {
        width: 99%;
        max-width: 414px;
        position: relative;
        z-index: 1;
        border-radius: 17px;
        margin-bottom: 2px;
        box-shadow: 0 4px 30px #d1e7ff44, 0 7px 32px #bee4ff0c;
        overflow: visible;
      }
      .mirror-blur {
        position: absolute;
        left: 0;
        right: 0;
        bottom: -16px;
        height: 31px;
        background: linear-gradient(to bottom, #bee8ffcc 60%, #fffefa00 100%);
        filter: blur(7px) opacity(0.65);
        z-index: 0;
        border-radius: 0 0 17px 17px;
        pointer-events: none;
        width: 100%;
      }
      .ticket-card {
        background: rgba(255, 255, 255, 0.97);
        border-radius: 17px;
        border: 2.5px solid #176bb9;
        overflow: hidden;
        box-shadow: 0 3px 16px #a8caff2e;
        position: relative;
      }
      .ticket-header {
        background: linear-gradient(90deg, #176bb9 0%, #234370 100%);
        color: #fff;
        font-size: 1.04rem;
        font-weight: 500;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 7px 15px 7px 13px;
        border-bottom: 2px solid #61c3fc;
        border-radius: 16px 16px 0 0;
      }
      .ticket-header .ticket-user {
        font-size: 1.01rem;
        font-weight: 500;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 130px;
      }
      .ticket-header .ticket-id {
        font-size: 1.01rem;
        font-weight: 500;
        background: #f8fdff;
        color: #134988;
        border-radius: 7px;
        padding: 0 8px;
        margin-left: 9px;
        box-shadow: 0 0.5px 3px #e8edfc;
      }
      .ticket-table-wrap {
        background: rgba(245, 250, 255, 0.94);
        border-radius: 0 0 16px 16px;
        box-shadow: 0 2px 11px #cbefff15 inset;
        padding: 7px 0 4px 0;
        border-top: 1.5px solid #e5eef8;
        border-bottom: 2.5px solid #91bdfd;
      }
      table.tambola-table {
        border-collapse: separate;
        border-spacing: 2.7px;
        width: 99%;
        margin: 0 auto;
        user-select: none;
      }
      table.tambola-table td {
        background: #f3f7fa;
        border-radius: 6px;
        width: 34px;
        height: 34px;
        text-align: center;
        font-size: 1.19rem;
        color: #215073;
        font-weight: 600;
        border: 2.1px solid #e2e9f2;
        transition: background 0.21s, color 0.19s, border 0.21s;
        box-shadow: 0 1px 5px #cee6fd44 inset;
        position: relative;
        z-index: 1;
        cursor: pointer;
      }
      table.tambola-table td:not(:empty) {
        background: #fff;
        border: 2.2px solid #86baf9;
      }
      table.tambola-table td.marked {
        background: #d6f6da !important;
        color: #19602f !important;
        border: 2.6px solid #38dc77 !important;
        box-shadow: 0 2px 9px #74f18c55, 0 1px 6px #fff inset;
        animation: pop 0.24s;
        font-size: 1.23rem;
        font-weight: bold;
        filter: drop-shadow(0 0 5px #8fffc0);
      }
      @keyframes pop {
        0% {
          transform: scale(1.18);
        }
        100% {
          transform: scale(1);
        }
      }
      .claim-btn {
        margin: 7px auto 7px auto;
        display: block;
        background: linear-gradient(90deg, #79ecda 0%, #268af8 100%);
        color: #fff;
        border: none;
        padding: 6px 21px;
        font-size: 1.04rem;
        border-radius: 11px;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 2px 8px #7ae2ffa0;
        transition: background 0.15s;
        z-index: 1;
        position: relative;
        letter-spacing: 0.5px;
      }
      .claim-btn:disabled {
        background: #dadada;
        color: #888;
        cursor: not-allowed;
      }
      .ticket-card.invalid {
        filter: blur(2px) grayscale(0.5) brightness(0.95);
        pointer-events: none;
        opacity: 0.62;
        position: relative;
      }
      .ticket-card.invalid::after {
        content: "DISQUALIFIED";
        color: #d40000;
        font-weight: bold;
        font-size: 1.01rem;
        letter-spacing: 1.1px;
        position: absolute;
        top: 44%;
        left: 0;
        right: 0;
        text-align: center;
        background: #fff8f8cc;
        padding: 5px 0 2px 0;
        border-radius: 0 0 16px 16px;
        z-index: 6;
        border-bottom: 2.1px solid #ea7171;
        box-shadow: 0 0 9px #ffd0d0;
      }
      .number-board-title {
        text-align: center;
        font-weight: bold;
        color: #15519b;
        font-size: 1.11rem;
        margin: 17px 0 3px 0;
      }
      .number-board {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        justify-content: center;
        padding: 7px 2px 10px 2px;
        background: #eef6ff;
        border-radius: 15px;
        box-shadow: 0 2px 8px #bfdfff1a;
        border: 1.6px solid #9fcaff;
        margin: 0 auto 13px auto;
        max-width: 405px;
        font-size: 1.01rem;
      }
      .numcell {
        width: 27px;
        height: 27px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #fff;
        border: 1.4px solid #c2dafc;
        border-radius: 7px;
        margin: 1px;
        font-weight: 600;
        color: #2178b1;
        font-size: 1.04rem;
        box-shadow: 0 0.5px 2px #c7eaff1c;
        transition: background 0.19s, color 0.18s, border-color 0.2s;
      }
      .numcell.called {
        background: #a6f7a5;
        color: #157b22;
        border: 2px solid #38db59;
        font-weight: bold;
        box-shadow: 0 1px 7px #5ff97c4a;
        animation: popnum 0.22s;
      }
      @media (max-width: 520px) {
        .container {
          max-width: 99vw;
        }
        .tambola-ticket-glass {
          max-width: 99vw;
        }
        table.tambola-table {
          font-size: 1.02rem;
        }
      }
      .modal-bg {
        position: fixed;
        z-index: 99;
        left: 0;
        top: 0;
        right: 0;
        bottom: 0;
        background: #0006;
        display: flex;
        justify-content: center;
        align-items: center;
        display: none;
      }
      .modal-bg.active {
        display: flex;
      }
      .claim-modal {
        background: #fffdfa;
        border-radius: 13px;
        box-shadow: 0 4px 32px #e9b63455;
        padding: 19px 12px 17px 13px;
        text-align: center;
        max-width: 330px;
        min-width: 190px;
        border: 2px solid #b5d4f9;
      }
      .claim-modal h2 {
        margin: 0 0 12px 0;
        color: #1c74c1;
        font-size: 1.12rem;
      }
      .claim-select {
        margin: 12px 0 19px 0;
      }
      .claim-select select {
        font-size: 1.04rem;
        padding: 5px 13px;
        border-radius: 7px;
        border: 1.7px solid #b5d4f9;
      }
      .close-btn {
        margin-top: 7px;
        background: #e2f0fd;
        color: #2267b8;
        border: none;
        border-radius: 7px;
        padding: 5px 14px;
        font-size: 1.01rem;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 1px 7px #b2dbff8a;
      }
      .footer {
        color: #666;
        font-size: 0.98em;
        text-align: center;
        margin-top: 13px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="title-banner">
        <span class="ticon">üé≤</span>
        <span class="title">Indian Tambola Game</span>
      </div>
      <div class="organizer-panel">
        <b>Aid of filling up the potholes of Imphal City.</b><br />
        Organized by: <b>Imphal Potholes Control</b><br />
        <span class="set-label"
          >SET OF 5 TICKETS (All tickets belong to: <b>Nathou Ntte</b>)</span
        >
      </div>
      <div class="prizes" id="prizeTracker"></div>
      <div class="set-claim-bar">
        <button
          class="set-claim-btn"
          id="setClaimBtn"
          onclick="openSetClaim()"
          disabled
        >
          Claim Set Prize
        </button>
      </div>
      <div class="call-section">
        <div class="announce-block">
          <div class="called-phrase" id="calledPhrase"></div>
          <div class="called-number" id="calledNumber">-</div>
        </div>
      </div>
      <div class="recent-panel">Recent Calls:</div>
      <div class="recent-announcements" id="recentPanel"></div>
      <div class="winner-banner" id="winnerBanner" style="display: none"></div>
      <div class="boo-banner" id="booBanner" style="display: none"></div>
      <div id="setPrizeBanner" class="set-prize-banner" style="display: none"></div>
      <div class="tickets-col" id="ticketsCol"></div>
      <div class="number-board-title">Number Board</div>
      <div class="number-board" id="numberBoard"></div>
      <div class="footer">
        ¬© 2025 RCS Official. All rights reserved. Demo Tambola Game for Events.
      </div>
      <div class="modal-bg" id="modalBg">
        <div class="claim-modal" id="claimModal">
          <h2>Claim Prize</h2>
          <div class="claim-select">
            <label for="claimSelect">Select prize:</label><br />
            <select id="claimSelect"></select>
          </div>
          <button class="close-btn" onclick="submitClaim()">
            Submit Claim
          </button>
          <button class="close-btn" onclick="closeModal()">Cancel</button>
          <div
            id="claimError"
            style="margin-top: 8px; color: #b00808; font-weight: bold"
          ></div>
        </div>
      </div>
    </div>

    <script>
      // --- Data ---
      const indianPhrases = {
        1:  "Single Start", 2:  "One little duck", 3:  "Trio", 4:  "Knock at the door", 5:  "Half a ten / Nickel", 6:  "Half a dozen", 7:  "Lucky Seven",
        8:  "Big Fat Lady", 9:  "Doctor's Number", 10: "One Zero, Hero", 11: "Legs Eleven", 12: "One Dozen", 13: "Unlucky for some",
        14: "Valentine's Day", 15: "Young and keen", 16: "Sweet sixteen", 17: "Dancing Queen", 18: "Voting Age", 19: "Goodbye Teens", 20: "One Score",
        21: "Key of the door", 22: "Two little ducks", 23: "You and me", 24: "Two Dozen", 25: "Quarter Century", 26: "Republic Day", 27: "Gateway to heaven",
        28: "Double Fourteen", 29: "Rise and shine", 30: "Dirty Gertie", 31: "Baskin Robbins Flavour", 32: "Buckle my shoe", 33: "All the Threes",
        34: "Poore Chaar", 35: "Jump and Jive", 36: "Three dozen", 37: "Two from 39", 38: "All the eights", 39: "Steps", 40: "Naughty Forty",
        41: "Time for fun", 42: "Winnie the Pooh", 43: "Down on your knees", 44: "Droopy Drawers", 45: "Halfway there", 46: "Up to tricks", 47: "Four and Seven",
        48: "Four Dozen", 49: "PC", 50: "Half Century", 51: "Tika", 52: "Pack of cards", 53: "Joker", 54: "Clean the floor", 55: "Speed Limit",
        56: "Was she worth it", 57: "Heinz Varieties", 58: "Make them wait", 59: "All the nines", 60: "Grandpa's age", 61: "Baker's bun", 62: "Tickety-boo",
        63: "A red card", 64: "Almost retired", 65: "Retirement age", 66: "Two fat ladies", 67: "Made in heaven", 68: "Saving Grace", 69: "Favorite Position",
        70: "Blind 70", 71: "Bang on the drum", 72: "Par for the course", 73: "Queen Bee", 74: "Candy store", 75: "Diamond Jubilee", 76: "Trombones",
        77: "Sunset strip", 78: "Heaven's gate", 79: "One more time", 80: "Gandhi's breakfast", 81: "Stop and run", 82: "Straight on through", 83: "Time for tea",
        84: "Seven dozen", 85: "Staying alive", 86: "Between the sticks", 87: "Fat lady with a crutch", 88: "Two fat ladies", 89: "Nearly there", 90: "Top of the house"
      };

      function generateTicket() {
        let numbers = [];
        let columns = Array.from({length:9}, (_,i) =>
          Array.from({length:10}, (_,j)=> (i*10 + j + 1)).filter(x=>x<=90)
        );
        
        let ticket = Array.from({length:3},()=>Array(9).fill(""));
        let colFill = Array(9).fill(0); 
        for(let i=0; i<15; i++) colFill[i%9]++; 
        shuffle(colFill);
        
        let numsNeeded = colFill.slice();
        for(let r=0;r<3;r++) {
          let cols = []; 
          for(let c=0;c<9;c++) if(numsNeeded[c]>0) cols.push(c);
          shuffle(cols); 
          let rowCols = cols.slice(0,5); 
          rowCols.sort((a,b)=>a-b);
          
          for(let c of rowCols) {
            let nCol = columns[c].filter(x=>!numbers.includes(x));
            let val = nCol.length ? nCol[Math.floor(Math.random()*nCol.length)] : null;
            if(val) { 
              ticket[r][c] = val; 
              numbers.push(val); 
              numsNeeded[c]--; 
            }
          }
        }
        
        for(let c=0;c<9;c++) {
          let colNumbers = []; 
          for(let r=0;r<3;r++) if(ticket[r][c]) colNumbers.push(ticket[r][c]);
          colNumbers.sort((a,b)=>a-b); 
          let idx = 0;
          for(let r=0;r<3;r++) if(ticket[r][c]) ticket[r][c] = colNumbers[idx++];
        }
        return ticket;
      }

      function shuffle(a) { 
        for(let i=a.length-1;i>0;i--){
          let j=Math.floor(Math.random()*(i+1));
          [a[i],a[j]]=[a[j],a[i]];
        } 
        return a; 
      }

      // TICKETS (use sequential ids for classic feel)
      const NUM_TICKETS = 5;
      const ticketOwner = "Nathou Ntte";
      const ticketNumbers = Array.from({length:NUM_TICKETS}, (_,i)=>i+1);
      const tickets = Array.from({length:NUM_TICKETS}, generateTicket);
      const userMarked = Array.from({length:NUM_TICKETS}, ()=>Array.from({length:3},()=>Array(9).fill(false)));
      const marked = Array.from({length:NUM_TICKETS}, ()=>Array.from({length:3},()=>Array(9).fill(false)));
      const ticketStatus = Array(NUM_TICKETS).fill('active'); // 'active' | 'invalid'
      
      let called = [];
      let remaining = shuffle(Array.from({length:90}, (_,i)=>i+1));
      let prizeClaimed = {
        'Early Five': false, 'Top Line': false, 'Middle Line': false,
        'Bottom Line': false, 'Full House': false, 'Set Prize': false
      };
      
      let currentTicketForClaim = null;

      function isCellMarked(ticketIdx, row, col) {
        return marked[ticketIdx][row][col] || userMarked[ticketIdx][row][col];
      }

      function checkPrizeEligibility(ticketIdx, prize) {
        if(prize === "Early Five") {
          let cnt = 0;
          for(let r=0;r<3;r++) for(let c=0;c<9;c++) if(isCellMarked(ticketIdx, r, c)) cnt++;
          return !prizeClaimed['Early Five'] && cnt >= 5;
        }
        if(prize === "Full House") {
          let cnt = 0;
          for(let r=0;r<3;r++) for(let c=0;c<9;c++) if(isCellMarked(ticketIdx, r, c)) cnt++;
          return !prizeClaimed['Full House'] && cnt === 15;
        }
        if(prize === "Top Line" || prize === "Middle Line" || prize === "Bottom Line") {
          const row = {"Top Line":0,"Middle Line":1,"Bottom Line":2}[prize];
          let total=0, markedRow=0;
          for(let c=0;c<9;c++) {
            if(tickets[ticketIdx][row][c]) total++;
            if(isCellMarked(ticketIdx, row, c) && tickets[ticketIdx][row][c]) markedRow++;
          }
          return !prizeClaimed[prize] && markedRow === total && total > 0;
        }
        if(prize === "Set Prize") {
          if(prizeClaimed['Set Prize']) return false;
          if(called.length === 0) return false;
          let latestNum = called[called.length-1];
          for(let t=0;t<NUM_TICKETS;t++) {
            let found = false;
            for(let r=0;r<3;r++) for(let c=0;c<9;c++)
              if(tickets[t][r][c] === latestNum) found = true;
            if(!found) return false;
          }
          return true;
        }
        return false;
      }

      function checkSetPrize(latestNum) {
        if(prizeClaimed['Set Prize']) return;
        let foundOnAll = true;
        for(let t=0;t<NUM_TICKETS;t++) {
          let present = false;
          for(let r=0;r<3;r++) for(let c=0;c<9;c++)
            if(tickets[t][r][c]===latestNum) present=true;
          if(!present) foundOnAll=false;
        }
        if(foundOnAll) {
          let banner = document.getElementById("setPrizeBanner");
          banner.innerHTML = `üèÜ <b>SET PRIZE Eligible!</b> Number <b>${latestNum}</b> appeared on all 5 tickets.<br>Press Claim Set Prize.`;
          banner.style.display="block";
          setTimeout(()=>{banner.style.display='none'}, 3400);
          enableSetClaimBtn();
        } else {
          disableSetClaimBtn();
        }
      }

      function enableSetClaimBtn() {
        let btn = document.getElementById("setClaimBtn");
        if(!prizeClaimed['Set Prize']) btn.disabled = false;
      }

      function disableSetClaimBtn() {
        let btn = document.getElementById("setClaimBtn");
        btn.disabled = true;
      }

      function announceWinner(prize, ticketIdx, setMode) {
        const banner = document.getElementById('winnerBanner');
        let msg = setMode
          ? `üèÜ <b>${ticketOwner}</b> wins <b>SET PRIZE</b>! (Tickets ${ticketNumbers.join(", ")}) üéâ`
          : `üèÜ <b>${ticketOwner}</b> wins <b>${prize}</b>! (Ticket #${ticketNumbers[ticketIdx]}) üéâ`;
        banner.innerHTML = msg;
        banner.style.display = "block";
        speakText(setMode
          ? `${ticketOwner} wins Set Prize on tickets ${ticketNumbers.join(", ")}!`
          : `${ticketOwner} wins ${prize} on Ticket ${ticketNumbers[ticketIdx]}`);
        setTimeout(()=>{banner.style.display="none"}, 4800);
        prizeClaimed[prize]=true;
        renderPrizeTracker();
        disableSetClaimBtn();
      }

      function announceBoo(ticketIdx) {
        const boo = document.getElementById('booBanner');
        boo.innerHTML = `üòµ Boo! <b>Invalid claim</b> on Ticket #${ticketNumbers[ticketIdx]}`;
        boo.style.display = "block";
        speakText(`Boo! Invalid claim on Ticket ${ticketNumbers[ticketIdx]}`);
        setTimeout(()=>{boo.style.display="none"}, 3800);
      }

      function speakText(text) {
        if ('speechSynthesis' in window) {
          let utterance = new SpeechSynthesisUtterance(text);
          utterance.rate = 0.9;
          speechSynthesis.speak(utterance);
        }
      }

      function callNextNumber() {
        if(remaining.length === 0) {
          alert("All numbers have been called!");
          return;
        }
        
        let num = remaining.pop();
        called.push(num);
        
        // Update display
        document.getElementById("calledNumber").textContent = num;
        document.getElementById("calledPhrase").textContent = indianPhrases[num] || "";
        
        // Update recent calls
        let recentPanel = document.getElementById("recentPanel");
        let recentItem = document.createElement("span");
        recentItem.className = "recent-item";
        recentItem.textContent = num;
        recentPanel.insertBefore(recentItem, recentPanel.firstChild);
        if(recentPanel.children.length > 8) {
          recentPanel.removeChild(recentPanel.lastChild);
        }
        
        // Mark on tickets
        for(let t=0; t<NUM_TICKETS; t++) {
          for(let r=0; r<3; r++) {
            for(let c=0; c<9; c++) {
              if(tickets[t][r][c] === num) {
                marked[t][r][c] = true;
              }
            }
          }
        }
        
        // Update number board
        let numCell = document.querySelector(`.numcell[data-num="${num}"]`);
        if(numCell) numCell.classList.add("called");
        
        // Check for set prize eligibility
        checkSetPrize(num);
        
        // Re-render tickets
        renderTickets();
      }

      function renderTickets() {
        let ticketsCol = document.getElementById("ticketsCol");
        ticketsCol.innerHTML = "";
        
        for(let t=0; t<NUM_TICKETS; t++) {
          let ticketGlass = document.createElement("div");
          ticketGlass.className = "tambola-ticket-glass";
          
          let ticketCard = document.createElement("div");
          ticketCard.className = `ticket-card ${ticketStatus[t] === 'invalid' ? 'invalid' : ''}`;
          
          // Ticket header
          let ticketHeader = document.createElement("div");
          ticketHeader.className = "ticket-header";
          ticketHeader.innerHTML = `
            <span class="ticket-user">${ticketOwner}</span>
            <span class="ticket-id">#${ticketNumbers[t]}</span>
          `;
          
          // Ticket table
          let tableWrap = document.createElement("div");
          tableWrap.className = "ticket-table-wrap";
          
          let table = document.createElement("table");
          table.className = "tambola-table";
          
          for(let r=0; r<3; r++) {
            let row = document.createElement("tr");
            for(let c=0; c<9; c++) {
              let cell = document.createElement("td");
              if(tickets[t][r][c]) {
                cell.textContent = tickets[t][r][c];
                if(isCellMarked(t, r, c)) {
                  cell.classList.add("marked");
                }
              }
              cell.onclick = () => toggleMark(t, r, c);
              row.appendChild(cell);
            }
            table.appendChild(row);
          }
          
          tableWrap.appendChild(table);
          
          // Claim button
          let claimBtn = document.createElement("button");
          claimBtn.className = "claim-btn";
          claimBtn.textContent = "Claim Prize";
          claimBtn.onclick = () => openClaimModal(t);
          claimBtn.disabled = ticketStatus[t] === 'invalid';
          
          ticketCard.appendChild(ticketHeader);
          ticketCard.appendChild(tableWrap);
          ticketCard.appendChild(claimBtn);
          
          ticketGlass.appendChild(ticketCard);
          ticketGlass.appendChild(document.createElement("div")).className = "mirror-blur";
          
          ticketsCol.appendChild(ticketGlass);
        }
      }

      function toggleMark(ticketIdx, row, col) {
        if(ticketStatus[ticketIdx] === 'invalid') return;
        if(!tickets[ticketIdx][row][col]) return;
        
        userMarked[ticketIdx][row][col] = !userMarked[ticketIdx][row][col];
        renderTickets();
      }

      function renderNumberBoard() {
        let board = document.getElementById("numberBoard");
        board.innerHTML = "";
        
        for(let i=1; i<=90; i++) {
          let cell = document.createElement("div");
          cell.className = "numcell";
          cell.textContent = i;
          cell.setAttribute("data-num", i);
          if(called.includes(i)) cell.classList.add("called");
          board.appendChild(cell);
        }
      }

      function renderPrizeTracker() {
        let tracker = document.getElementById("prizeTracker");
        tracker.innerHTML = "";
        
        let prizes = ['Early Five', 'Top Line', 'Middle Line', 'Bottom Line', 'Full House'];
        for(let prize of prizes) {
          let el = document.createElement("div");
          el.className = `prize ${prizeClaimed[prize] ? 'claimed' : ''}`;
          el.textContent = prize;
          tracker.appendChild(el);
        }
      }

      function openClaimModal(ticketIdx) {
        currentTicketForClaim = ticketIdx;
        let modal = document.getElementById("modalBg");
        let select = document.getElementById("claimSelect");
        select.innerHTML = "";
        
        let prizes = ['Early Five', 'Top Line', 'Middle Line', 'Bottom Line', 'Full House'];
        let hasEligible = false;
        
        for(let prize of prizes) {
          if(checkPrizeEligibility(ticketIdx, prize)) {
            let option = document.createElement("option");
            option.value = prize;
            option.textContent = prize;
            select.appendChild(option);
            hasEligible = true;
          }
        }
        
        if(!hasEligible) {
          let option = document.createElement("option");
          option.value = "";
          option.textContent = "No prizes eligible";
          select.appendChild(option);
          select.disabled = true;
        } else {
          select.disabled = false;
        }
        
        document.getElementById("claimError").textContent = "";
        modal.classList.add("active");
      }

      function openSetClaim() {
        currentTicketForClaim = null;
        let modal = document.getElementById("modalBg");
        let select = document.getElementById("claimSelect");
        select.innerHTML = "";
        
        if(checkPrizeEligibility(0, "Set Prize")) {
          let option = document.createElement("option");
          option.value = "Set Prize";
          option.textContent = "Set Prize";
          select.appendChild(option);
          select.disabled = false;
        } else {
          let option = document.createElement("option");
          option.value = "";
          option.textContent = "Set Prize not eligible";
          select.appendChild(option);
          select.disabled = true;
        }
        
        document.getElementById("claimError").textContent = "";
        modal.classList.add("active");
      }

      function submitClaim() {
        let select = document.getElementById("claimSelect");
        let prize = select.value;
        let errorEl = document.getElementById("claimError");
        
        if(!prize || select.disabled) {
          errorEl.textContent = "No eligible prize selected";
          return;
        }
        
        if(currentTicketForClaim !== null) {
          // Regular claim
          if(checkPrizeEligibility(currentTicketForClaim, prize)) {
            announceWinner(prize, currentTicketForClaim, false);
            closeModal();
          } else {
            announceBoo(currentTicketForClaim);
            ticketStatus[currentTicketForClaim] = 'invalid';
            renderTickets();
            closeModal();
          }
        } else {
          // Set prize claim
          if(checkPrizeEligibility(0, "Set Prize")) {
            announceWinner("Set Prize", 0, true);
            closeModal();
          } else {
            errorEl.textContent = "Set Prize no longer eligible";
          }
        }
      }

      function closeModal() {
        document.getElementById("modalBg").classList.remove("active");
      }

      // Initialize the game
      window.onload = function() {
        renderTickets();
        renderNumberBoard();
        renderPrizeTracker();
        
        // Add keyboard shortcut for calling numbers
        document.addEventListener('keydown', function(e) {
          if(e.code === 'Space') {
            e.preventDefault();
            callNextNumber();
          }
        });
        
        // Add click handler for called number display
        document.getElementById("calledNumber").onclick = callNextNumber;
      };
    </script>
  </body>
</html>